<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.87.0" />
    <meta name="description" content="">
<meta name="author" content="Philip Lei">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>4-6 Web app routing :: COMP312 notes</title>

    
    <link href="/css/nucleus.css?1632019543" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1632019543" rel="stylesheet">
    <link href="/css/featherlight.min.css?1632019543" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1632019543" rel="stylesheet">
    <link href="/css/auto-complete.css?1632019543" rel="stylesheet">
    <link href="/css/theme.css?1632019543" rel="stylesheet">
    <link href="/css/tabs.css?1632019543" rel="stylesheet">
    <link href="/css/hugo-theme.css?1632019543" rel="stylesheet">
    
    <link href="/css/theme-green.css?1632019543" rel="stylesheet">
    
    

    <script src="/js/jquery.min.js?1632019543"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/server/o4-3/">
    <nav id="sidebar" class="">
  
  
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://philiplei.github.io">
    <i class="fas fa-file-code"></i> <b>COMP312 course notes</b>
</a>

    </div>
    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href="/"><i class="fas fa-home"></i> Home</a>
        </li>
      </ul>
    </section>
  

  <div class="highlightable">
    <ul class="topics">
      
        
        





  
		
    
      
      
      <li data-nav-id="/basic/" title="JavaScript basics" class="dd-item">
        <a href="/basic/">
          
JavaScript basics

          
        </a>
        <ul>
          
          
          

          
            
            





  
		
    
      <li data-nav-id="/basic/2-1/" title="2-1 Basic data types and control" class="dd-item">
        <a href="/basic/2-1/">
          
2-1 Basic data types and control

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/basic/2-2/" title="2-2 Arrays" class="dd-item">
        <a href="/basic/2-2/">
          
2-2 Arrays

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/basic/2-3/" title="2-3 Functions" class="dd-item">
        <a href="/basic/2-3/">
          
2-3 Functions

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/basic/2-4/" title="2-4 Objects as data structure" class="dd-item">
        <a href="/basic/2-4/">
          
2-4 Objects as data structure

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/basic/2-5/" title="2-5 Functions as objects and callbacks" class="dd-item">
        <a href="/basic/2-5/">
          
2-5 Functions as objects and callbacks

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/basic/2-6/" title="2-6 Objects with methods" class="dd-item">
        <a href="/basic/2-6/">
          
2-6 Objects with methods

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/basic/2-7/" title="2-7 Defining class" class="dd-item">
        <a href="/basic/2-7/">
          
2-7 Defining class

          
        </a>
      </li>
    
  

            
          
        </ul>
      </li>
    
  

        
        





  
		
    
      
      
      <li data-nav-id="/client/" title="Client-side programming" class="dd-item">
        <a href="/client/">
          
Client-side programming

          
        </a>
        <ul>
          
          
          

          
            
            





  
		
    
      <li data-nav-id="/client/3-1/" title="3-1 Background" class="dd-item">
        <a href="/client/3-1/">
          
3-1 Background

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/client/3-2/" title="3-2 Vue application basics" class="dd-item">
        <a href="/client/3-2/">
          
3-2 Vue application basics

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/client/3-3/" title="3-3 Dynamic structure in template" class="dd-item">
        <a href="/client/3-3/">
          
3-3 Dynamic structure in template

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/client/3-4/" title="3-4 Events, methods and component lifecycle" class="dd-item">
        <a href="/client/3-4/">
          
3-4 Events, methods and component lifecycle

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/client/3-5/" title="3-5 Form controls and bi-directional binding" class="dd-item">
        <a href="/client/3-5/">
          
3-5 Form controls and bi-directional binding

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/client/3-6/" title="3-6 Component: motivation and features" class="dd-item">
        <a href="/client/3-6/">
          
3-6 Component: motivation and features

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/client/3-7/" title="3-7 Vue projects and build tools" class="dd-item">
        <a href="/client/3-7/">
          
3-7 Vue projects and build tools

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/client/3-8/" title="3-8 Make your own components" class="dd-item">
        <a href="/client/3-8/">
          
3-8 Make your own components

          
        </a>
      </li>
    
  

            
          
        </ul>
      </li>
    
  

        
        





  
		
    
      
      
      <li data-nav-id="/server/" title="Server-side programming" class="dd-item parent">
        <a href="/server/">
          
Server-side programming

          
        </a>
        <ul>
          
          
          

          
            
            





  
		
    
      <li data-nav-id="/server/4-1/" title="4-1 Node.js primer" class="dd-item">
        <a href="/server/4-1/">
          
4-1 Node.js primer

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/4-2/" title="4-2 Asynchronous callback" class="dd-item">
        <a href="/server/4-2/">
          
4-2 Asynchronous callback

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/4-3/" title="4-3 Promise, await and async" class="dd-item">
        <a href="/server/4-3/">
          
4-3 Promise, await and async

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/4-4/" title="4-4 ES modules" class="dd-item">
        <a href="/server/4-4/">
          
4-4 ES modules

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/4-5/" title="4-5 Database access" class="dd-item">
        <a href="/server/4-5/">
          
4-5 Database access

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/o4-3/" title="4-6 Web app routing" class="dd-item active">
        <a href="/server/o4-3/">
          
4-6 Web app routing

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/o4-4/" title="4-7 Web app middlewares" class="dd-item">
        <a href="/server/o4-4/">
          
4-7 Web app middlewares

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/o4-5/" title="4-8 Templates and file modules" class="dd-item">
        <a href="/server/o4-5/">
          
4-8 Templates and file modules

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/o4-6/" title="4-x Database access" class="dd-item">
        <a href="/server/o4-6/">
          
4-x Database access

          
        </a>
      </li>
    
  

            
            





  
		
    
      <li data-nav-id="/server/o4-7/" title="4-x A sample web app" class="dd-item">
        <a href="/server/o4-7/">
          
4-x A sample web app

          
        </a>
      </li>
    
  

            
          
        </ul>
      </li>
    
  

        
      
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/server/'>Server-side programming</a> > 4-6 Web app routing
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#routes">Routes</a></li>
    <li><a href="#making-responses">Making responses</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              4-6 Web app routing
            </h1>
          

        


<p>Express.js <a href="http://expressjs.com/">(official website)</a> is a web framework to simplify development of Web applications. It supports:</p>
<ul>
<li>Routing – different request processing based on URL patterns</li>
<li>Middleware – chainable processing of requests and responses</li>
<li>Template – generate HTML output from variables</li>
</ul>
<p>This lab covers how to define routes to capture HTTP requests for a web app / service endpoints. In addition, we&rsquo;ll discuss how to generate simple HTTP responses.</p>
<h2 id="routes">Routes</h2>
<p>This example shows the basic structure of an Express app.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:3;-o-tab-size:3;tab-size:3"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
<span style="color:#75715e">// create an Express application, which will handle HTTP requests
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();

<span style="color:#75715e">// a route in the app, which handles GET request for the path &#39;/&#39;
</span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>);
});

<span style="color:#75715e">// more routes ...
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// start listening at TCP port 3000
</span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#ae81ff">3000</span>);
</code></pre></div><p>When a web app receives an HTTP request, it has to decide how to handle the request, and return the result as an HTTP response.  Such decision usually depends on the HTTP method (either GET or POST in most cases) and the path in the URL (e.g. &ldquo;/about.html&rdquo;).   The combination of HTTP method and the URL path is usually referred to as an <strong>endpoint</strong> of the web app or web service.</p>
<p>In an Express app, we define a <strong>route</strong> to describe how to process HTTP requests at an endpoint.
The general syntax is <code>app.get(path, callback)</code> and <code>app.post(path, callback)</code>. The callback can take 2 or more parameters.  Often, we only use the first two parameters called <code>req</code> and <code>res</code>: <code>req</code> refers to the incoming HTTP request, and <code>res</code> is an object that is used to build the HTTP response. The following is a route for GET request at URL &lsquo;/about.html&rsquo;. The route returns a text response.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:3;-o-tab-size:3;tab-size:3"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#75715e">// app is an Express app
</span><span style="color:#75715e"></span>
<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/about.html&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
  <span style="color:#75715e">// When the Express app receives a GET request
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// for the path &#39;/about.html&#39;, it returns a text response
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;This is a simple example of route&#39;</span>)
});
</code></pre></div><p>Some web apps include parameters in the URL path. For example, the URL <a href="https://www.google.com/maps/place/Macao+Polytechnic+Institute/">https://www.google.com/maps/place/Macao+Polytechnic+Institute/</a> refers to the place &lsquo;Macao Polytechnic Institute&rsquo; in the Google Maps web app.  You can easily extract these parameters in Express routes.</p>
<p>Consider the sample code below, which shows a web app to check lecture hours. When the app receives a GET request for the path &lsquo;/lecture/comp312&rsquo;, it returns a response of its lecture hours. The parameters are available in the object <code>req.params</code>. (The full source is <a href="/chap4-3/app1.js">app1.js</a>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:3;-o-tab-size:3;tab-size:3"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#75715e">// retrieve the lecture time
</span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/lecture/:code&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
  <span style="color:#75715e">// in a real app, we&#39;d query a database ...
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">code</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#39;comp312&#39;</span>) {
    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Tue, Thu: 10:00-11:30am&#39;</span>)
  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">code</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#39;comp311&#39;</span>) {
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>  }
})
</code></pre></div><p>The above only describes the basics of routing in Express. Refer to the <a href="http://expressjs.com/en/guide/routing.html">online guide</a> for more possibilities.</p>
<p><strong>The order of routes is significant!</strong>  An Express app checks the routes in the order they are defined. When a route matches the HTTP methods and URL path, the Express app executes its callback function to handle the request.  The callback usually returns an HTTP response with <code>res.send()</code> or similar methods. When a response is returned, the Express app will <strong>stop</strong> checking the remaining routes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:3;-o-tab-size:3;tab-size:3"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/lecture/comp312&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
  <span style="color:#75715e">// special response for comp312
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;...&#39;</span>);
});

<span style="color:#75715e">// retrieve the lecture time
</span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/lecture/:code&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
  <span style="color:#75715e">// search database, return a response
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;...&#39;</span>);
});

<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/lecture/comp113&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
  <span style="color:#75715e">// special response for comp113. But sorry, this route never runs!
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;...&#39;</span>);
});
</code></pre></div><h2 id="making-responses">Making responses</h2>
<p>You can use the <code>res</code> object in the route callback to build a response. <a href="http://expressjs.com/en/4x/api.html#res">(online reference)</a> The <code>res</code> object has several common methods:</p>
<ul>
<li><code>res.send(body)</code> sends a response with the specified body. The body is usually a string, but it can also be JavaScript objects or others.  The method determines the suitable MIME type.</li>
<li><code>res.sendFile(path)</code> returns a file as response.</li>
<li><code>res.status(code)</code> sets the HTTP response code. This function is chainable.</li>
<li><code>res.redirect(path)</code> redirects to the given URL.</li>
</ul>
<p>Check the source code of <a href="/chap4-3/app2.js">app2.js</a> for demonstration of how to build responses with these methods.</p>



<footer class="footline">
    
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        
        
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1632019543"></script>
    <script src="/js/perfect-scrollbar.min.js?1632019543"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1632019543"></script>
    <script src="/js/jquery.sticky.js?1632019543"></script>
    <script src="/js/jquery.svg.pan.zoom.js?1632019543"></script>
    <script src="/js/featherlight.min.js?1632019543"></script>
    <script src="/js/modernizr.custom-3.6.0.js?1632019543"></script>
    
        
            <script src="/js/mermaid.min.js?1632019543"></script>
        
        
            
        
        <script>
            if (mermaid) {
                mermaid.mermaidAPI.initialize( Object.assign( { "securityLevel": "antiscript" }, JSON.parse("{ \"startOnLoad\": true }"), { startOnLoad: false } ) );
            }
        </script>
    
    <script src="/js/relearn.js?1632019543"></script>
    

  </body>
</html>

